{{ define "main" }}
{{ if .Params.featured_image }}
<div class="article-hero" style="background-image: url('{{ .Params.featured_image }}');">
  <div class="article-hero-overlay">
    <div class="container">
      <div class="breadcrumb breadcrumb-light">
        <a href="/">Home</a> &rsaquo;
        {{ range .Params.categories }}<a href="/categories/{{ . }}/">{{ . | humanize | title }}</a>{{ end }}
        &rsaquo; {{ .Title }}
      </div>
      <h1 class="article-hero-title">{{ .Title }}</h1>
      {{ if not .Date.IsZero }}<div class="meta meta-light">{{ .Date.Format "January 2, 2006" }} &middot; {{ .ReadingTime }} min read</div>{{ end }}
    </div>
  </div>
</div>
<div class="container">
  <article>
{{ else }}
<div class="container">
  <article>
    <div class="breadcrumb">
      <a href="/">Home</a> &rsaquo;
      {{ range .Params.categories }}<a href="/categories/{{ . }}/">{{ . | humanize | title }}</a>{{ end }}
      &rsaquo; {{ .Title }}
    </div>
    {{ if not .Date.IsZero }}<div class="meta">{{ .Date.Format "January 2, 2006" }} &middot; {{ .ReadingTime }} min read &middot; Updated {{ .Lastmod.Format "January 2, 2006" }}</div>{{ end }}
    <h1>{{ .Title }}</h1>
{{ end }}
    {{ if .Params.affiliate }}
    <div class="affiliate-disclosure">
      This article contains affiliate links. We may earn a commission at no extra cost to you.
    </div>
    {{ end }}
    {{ .Content }}
    {{ if .Params.tags }}
    <div class="tags" style="margin-top:2rem;">
      {{ range .Params.tags }}<span class="tag">{{ . }}</span>{{ end }}
    </div>
    {{ end }}

    {{ if .Params.faq }}
    <div class="faq-section">
      <h2>Frequently Asked Questions</h2>
      {{ range .Params.faq }}
      <details class="faq-item">
        <summary>{{ .q }}</summary>
        <p>{{ .a }}</p>
      </details>
      {{ end }}
    </div>
    {{ end }}

    <div class="author-box">
      {{ if .Params.author }}
      <div class="author-avatar">{{ index (split .Params.author " ") 0 | truncate 1 "" }}{{ index (split .Params.author " ") 1 | truncate 1 "" }}</div>
      <div class="author-info">
        <div class="author-name">{{ .Params.author }}</div>
        <div class="author-bio">{{ with .Params.author_bio }}{{ . }}{{ else }}Expat coach and relocation specialist at Expat Netherlands Hub.{{ end }}</div>
      </div>
      {{ else }}
      <div class="author-avatar">ENH</div>
      <div class="author-info">
        <div class="author-name">Expat Netherlands Hub Team</div>
        <div class="author-bio">Our team of expats and local experts creates practical guides to help you navigate life in the Netherlands.</div>
      </div>
      {{ end }}
    </div>

    {{ $allOther := where (where .Site.RegularPages "Type" "posts") ".Permalink" "ne" .Permalink }}
    {{ $related := where $allOther ".Params.categories" "intersect" .Params.categories }}
    {{ if not $related }}{{ $related = $allOther }}{{ end }}
    {{ $related = first 4 $related }}
    {{ if $related }}
    <div class="related-articles">
      <h3>Related Expat Guides</h3>
      <ul>
        {{ range $related }}
        <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
        {{ end }}
      </ul>
    </div>
    {{ end }}
  </article>
</div>
{{ end }}
